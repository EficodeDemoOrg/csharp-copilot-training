@inject HttpClient Http
@using Microsoft.AspNetCore.Components.Web

@page "/counter"
@rendermode InteractiveServer

<PageTitle>Counter</PageTitle>

<h1>Counter</h1>

@if (!string.IsNullOrEmpty(errorMessage))
{
    <p class="text-danger">@errorMessage</p>
}

<p role="status">Current count: @currentCount</p>

<button class="btn btn-primary" @onclick="IncrementCount">Click me</button>

@code {
    private int currentCount = 0;
    private string? errorMessage;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            // Call the updated "Get" API to fetch the current counter value
            currentCount = await Http.GetFromJsonAsync<int>("api/counter");
            errorMessage = null; // Clear any previous error
        }
        catch (Exception ex)
        {
            errorMessage = "Failed to load the current count. Please try again later.";
            Console.Error.WriteLine($"Error fetching counter value: {ex.Message}");
        }
    }

    private async Task IncrementCount()
    {
        try
        {
            // Call the updated "Increment" API to increment the counter
            var response = await Http.PostAsync("api/counter/Increment", null);
            if (response.IsSuccessStatusCode)
            {
                currentCount++;
                errorMessage = null; // Clear any previous error
            }
            else
            {
                errorMessage = "Failed to increment the counter. Please try again later.";
            }
        }
        catch (Exception ex)
        {
            errorMessage = "An error occurred while incrementing the counter. Please try again later.";
            Console.Error.WriteLine($"Error incrementing counter: {ex.Message}");
        }
    }
}
